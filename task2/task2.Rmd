---
title: "Assignment on linear models"
output: html_notebook
---

## Ксюша, шоколад должен быть белый с ванилью))

Anadarko Petroleum Corp. (APC) has been chosen to complete the assignment.

The data is obtained from Google Finance for a period since 2009/01/01, each observation is a single day.

**All statistical assumptions and conclusions are made on the 5% significance level.**

The closing price is obtained the following way:
```{r message=FALSE}
library(quantmod)
apc = Cl(getSymbols('RDY', src='google', auto.assign=FALSE, from='2009-01-01'))
```

# Stationary AR models
## Task (a)

> Compute and plot the log price xt and the log return rt. Comment on the two plots
(how volatile the data are, volatility clustering, outliers etc).

```{r}
logapc = log(apc)
logrtapc = diff(logapc)

plot(logapc)
plot(logrtapc)
```

## Task (b)

> Compute and plot the first 12 lags of ACF of xt. Comment on the plot. Based on the
ACF, is there a unit root in xt dataset? Why?

```{r}
acf(as.numeric(na.omit(logapc)))
```

## Task (c)

> Consider the time series for rt. Perform the Ljung-Box test for m = 12. Draw a
conclusion and justify it with the statistical language, i.e., in terms of the critical
region or p-value.

```{r}
Box.test(as.numeric(logrtapc), lag=12, type='Ljung-Box')
```

## Task (d)

> Use the command ar(rt,method='mle',order.max=20) to specify the order of an AR
model for rt. Use the PACF and AIC criteria (ar() and pacf() commands). Compare
both approaches.

```{r}
ar(as.numeric(na.omit(logrtapc)),method='mle',order.max=20)
```

```{r}
ar2$aic
```

```{r}
pacf(as.numeric(na.omit(logrtapc)))
```

## Task (e)

> Build an AR model for rt. Plot the time series of the residuals, ACF and p-values of
the Ljung-Box test (command tsdiag()). Perform the Ljung-Box test of the residuals
by hand adjusting the degrees of freedom for the number of the model parameters (see
[2], p.66). Is the model adequate? Why? Refine the model by eliminating all estimates
with t-ratio less than 1.645 and check the new model as described above. Is the new
model adequate? Why? Write down the final model.

```{r}
ar2 = arima(as.numeric(na.omit(logrtapc)), c(2,0,0))
ar2

ar2 = arima(as.numeric(na.omit(logrtapc)), c(2,0,0), fixed=c(0, NA, NA))
ar2
```

```{r fig.width=12}
tsdiag(ar2)
```

## Task (f)

> Does the model imply existence of a cycle? Why? If the cycles are present, compute
the average length of these cycles.

```{r}
k = predict(ar2, 5)
k
```

# MA model

## Task (a)

> Choose the order of such model. Support your choice with the ACF plot.

```{r}
acf(as.numeric(na.omit(logrtapc)))
```

## Task (b)

> Build the model. Refne it by removing coefficients estimates with t-ratio less than
1.645. Write down the ftted model.

```{r fig.width=12}
ma2 = arima(as.numeric(na.omit(logrtapc)), order=c(0,0,2))
ma2

ma2 = arima(as.numeric(na.omit(logrtapc)), order=c(0,0,2), fixed=c(0, NA, NA))
ma2

tsdiag(ma2)
```

## Task (c)

> Compute the Ljung-Box statistic of the residuals of the fitted MA model. Is there serial
correlation in the residuals? Why?

```{r fig.width=12}
Box.test(ma2$residuals, lag=12, type='Ljung-Box')
```

## Task (d)

> Consider the in-sample fits of the AR model of Problem 1 and the MA model. Which
model is preferred? Why?

<!-- Something about the AIC goes here, because otherwise they deal with the data quite well -->

## Task (e)

> Use backtest at some forecast origin with horizon h = 1 to compare the two models.
Indicate clearly the parameters of such backtesting (the estimation and forecasting
subsamples, forecast origin and so on). Which model is preferred? Why?

<!-- I guess I need to check the lecture slides -->

# ARIMA model

> Yet again, focus on the log return series rt of the asset from Problem 1. Build an ARMA
model including
(a) Choosing the order of the model,
(b) Writing down the model,
(c) Checking the model for adequacy by analyzing the residuals,
(d) Backtesting and comparing the model with those of Problems 1 and 2.

# Daily range

> Consider the daily range (daily high minus daily low) of a \blue chip" stock (Apple, Coca-
Cola etc.) for the last 4 years. Compute the rst 100 lags of ACF of this series. Is there
evidence of long-range dependence? Explain! If the range series has long memory, build an
AFRIMA model for the data.

# ARCH effect

> (a) Build an appropriate ARMA model.
(b) Test the residuals for the ARCH effect.
(c) Fit an ARMA-GARCH Gaussian model to the data.
(d) Check the model by analyzing standardized residuals.
(e) Rebuild and check the model using Student t innovations.
(f) Build and check an ARMA-APACRH model (order=2).
(g) Make and plot forecasts based on the above models.

